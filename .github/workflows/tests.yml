# [[ ]] testing doesn't like when you interpolate a multi-line ${{ steps. . . }} right in the -z ""; set it to a variable first, then test a single line
# Must single quote output in run: due to quotes in vm-commands: (basic)

name: Tests
on:
  push:
    branches: [ release/* ]

jobs:

  job1:
    runs-on: [self-hosted, macOS]
    outputs:
      output1: ${{ steps.step1.outputs.test }}
    steps:
      - id: step1
        run: echo "::set-output name=test::$(hostname)"

  job2:
    runs-on: ${{needs.job1.outputs.output1}}
    needs: job1
    steps:
      - run: echo ${{needs.job1.outputs.output1}} ${{needs.job1.outputs.output2}}


  #     - name: Check for output (testing anything *.test.js doesn't)
  #       run: |
  #         PULL_TEST_PREP_ONE_STD='${{ steps.pull-test-prep-1.outputs.std }}'
  #         printf "\n=======================\npull-test-prep-1 std\n========================\n$PULL_TEST_PREP_ONE_STD"
  #         [[ ! -z "$(echo \\"$PULL_TEST_PREP_ONE_STD\\" | head -n 1)" ]] || exit 1
  #         [[ -z "$(echo \\"$PULL_TEST_PREP_ONE_STD\\" | grep 'vm created successfully with uuid')" ]] || exit 2

  #         true

  # functional-tests:
  #   runs-on: [self-hosted, macOS]
  #   needs: [prep, failure-tests]
  #   steps:
  #     - uses: actions/checkout@v2
  #     - name: pull test prep 2
  #       id: pull-test-prep-2
  #       uses: ./
  #       with:
  #         host-pre-commands: "env; anka delete --yes 11.4 || true; anka delete --yes 11.4-openjdk-1.8.0_292 || true"
  #         anka-vm-template-name: "11.4"
  #         anka-vm-tag-name: "vanilla"
  #         vm-commands: ""

  #     - name: Check for output (testing anything execute.test.js doesn't)
  #       run: |
  #         PULL_TEST_PREP_TWO_STD='${{ steps.pull-test-prep-2.outputs.std }}'
  #         printf "\n=======================\npull-test-prep-2 std\n========================\n$PULL_TEST_PREP_TWO_STD"
  #         [[ ! -z "$(echo \\"$PULL_TEST_PREP_TWO_STD\\" | head -n 1)" ]] || exit 1
  #         [[ -z "$(echo \\"$PULL_TEST_PREP_TWO_STD\\"  | grep '/Users/anka')" ]] || exit 2
  #         [[ ! -z "$(echo \\"$PULL_TEST_PREP_TWO_STD\\"  | grep 'pull-test-prep-2_readyForCleanup=true')" ]] || exit 3
  #         [[ -z "$(echo \\"$PULL_TEST_PREP_TWO_STD\\"  | grep 'pull-test-prep-2_cloneCreated')" ]] || exit 4
  #         [[ -z "$(echo \\"$PULL_TEST_PREP_TWO_STD\\"  | grep 'pull-test-prep-2_hasPullLockFile')" ]] || exit 5

  #         true
